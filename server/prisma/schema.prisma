generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  name      String
  cro       String?
  role      String   @default("admin")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Post {
  id         Int      @id @default(autoincrement())
  slug       String   @unique
  title      String
  excerpt    String
  content    String
  category   String
  date       DateTime
  readTime   String
  image      String
  images     String[]
  author     String
  references Json?    
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Appointment {
  id           Int      @id @default(autoincrement())
  patientName  String
  cpf          String?
  date         DateTime
  procedure    String
  notes        String
  professional String
  patientId    Int?
  patient      Patient? @relation(fields: [patientId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Treatment {
  id          Int      @id @default(autoincrement())
  slug        String   @unique
  title       String
  description String
  category    String
  image       String
  content     String
  indications String[]
  benefits    String[]
  duration    Json     // Stores { procedure: string, recovery: string, longevity: string }
  results     TreatmentResult[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model TreatmentResult {
  id          Int      @id @default(autoincrement())
  treatmentId Int
  treatment   Treatment @relation(fields: [treatmentId], references: [id], onDelete: Cascade)
  image       String
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Story {
  id          Int      @id @default(autoincrement())
  type        String   // "image" or "video"
  url         String
  title       String?
  status      String   @default("active") // "active" or "expired"
  views       Int      @default(0)
  createdAt   DateTime @default(now())
  expiresAt   DateTime?
}

model Setting {
  id    Int    @id @default(autoincrement())
  key   String @unique
  value String @db.Text
}

model Patient {
  id            Int            @id @default(autoincrement())
  name          String
  cpf           String         @unique
  phone         String?
  address       String?
  history       String?        @db.Text
  appointments  Appointment[]
  prescriptions Prescription[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model Prescription {
  id        Int      @id @default(autoincrement())
  content   String   @db.Text
  date      DateTime @default(now())
  patientId Int
  patient   Patient  @relation(fields: [patientId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

