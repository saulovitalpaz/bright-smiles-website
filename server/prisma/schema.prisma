generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  name      String
  cro       String?
  role      String   @default("admin")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Post {
  id         Int      @id @default(autoincrement())
  slug       String   @unique
  title      String
  excerpt    String
  content    String
  category   String
  date       DateTime
  readTime   String
  image      String
  images     String[]
  author     String
  views      Int      @default(0)
  references Json?    
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Appointment {
  id           Int      @id @default(autoincrement())
  patientName  String
  cpf          String?
  date         DateTime
  procedure    String
  notes        String
  weight       String?
  materials    String?
  complications String?
  returnDate   DateTime?
  professional String
  patientId    Int?
  patient      Patient? @relation(fields: [patientId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Treatment {
  id          Int      @id @default(autoincrement())
  slug        String   @unique
  title       String
  description String
  category    String
  image       String
  content     String
  indications String[]
  benefits    String[]
  duration    Json     // Stores { procedure: string, recovery: string, longevity: string }
  results     TreatmentResult[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model TreatmentResult {
  id          Int      @id @default(autoincrement())
  treatmentId Int
  treatment   Treatment @relation(fields: [treatmentId], references: [id], onDelete: Cascade)
  image       String
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Story {
  id          Int      @id @default(autoincrement())
  type        String   // "image" or "video"
  url         String
  title       String?
  status      String   @default("active") // "active" or "expired"
  views       Int      @default(0)
  createdAt   DateTime @default(now())
  expiresAt   DateTime?
}

model Setting {
  id    Int    @id @default(autoincrement())
  key   String @unique
  value String @db.Text
}

model Patient {
  id            Int            @id @default(autoincrement())
  name          String
  cpf           String         @unique
  phone         String?
  address       String?
  history       String?        @db.Text
  odontogram    Json?
  consent       Boolean        @default(false)
  consentDate   DateTime?
  appointments  Appointment[]
  prescriptions Prescription[]
  finance       FinanceTransaction[]
  documents     PatientDocument[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model Prescription {
  id        Int      @id @default(autoincrement())
  content   String   @db.Text
  date      DateTime @default(now())
  patientId Int
  patient   Patient  @relation(fields: [patientId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model Lead {
  id        Int      @id @default(autoincrement())
  name      String
  phone     String
  email     String?
  ageGroup  String?  // Kids, Teen, Adult, Senior
  treatment String?
  message   String?
  status    String   @default("new") // new, contacted, scheduled
  source    String?  // Instagram, Google, etc.
  location  String?  // City/Region
  createdAt DateTime @default(now())
}

model Testimonial {
  id        Int      @id @default(autoincrement())
  name      String? // Optional if anonymous
  rating    Int
  comment   String
  feeling   String?  // emoji feeling: happy, neutral, sad, love, wow
  approved  Boolean  @default(false)
  createdAt DateTime @default(now())
}

model FinanceTransaction {
  id          Int      @id @default(autoincrement())
  type        String   // "income" or "expense"
  amount      Float
  category    String
  description String
  date        DateTime @default(now())
  patientId   Int?
  patient     Patient? @relation(fields: [patientId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model DocumentTemplate {
  id        Int      @id @default(autoincrement())
  title     String
  content   String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PatientDocument {
  id        Int      @id @default(autoincrement())
  title     String
  content   String   @db.Text
  date      DateTime @default(now())
  pdfUrl    String? // URL for the signed/uploaded PDF
  patientId Int
  patient   Patient  @relation(fields: [patientId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AnalyticsEvent {
  id        Int      @id @default(autoincrement())
  type      String   @default("pageview")
  path      String
  ip        String?
  userAgent String?
  source    String?
  location  String?
  date      DateTime @default(now())
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  userId    Int?     // Nullable if system action or unauthenticated
  action    String   // READ, WRITE, DELETE, LOGIN, etc.
  resource  String   // Patient, Appointment, etc.
  details   String?  @db.Text
  ip        String?
  timestamp DateTime @default(now())
}
